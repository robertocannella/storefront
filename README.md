# Setup Project

## Configure Environment
1. Project Directory
    
    Create the project directory and then navigate to that directory.  This can be done within any directory:

    ```
    mkdir storefront
    cd storefront
    ```
2. Create Virtual Environment

    Use `vitualenv` to create an virtual python environment. Then activate the environment:

    ```
    virtualenv venv
    source venv/bin/activate
    ```
3. Install Django within the virtual environment.

    Install Django and create a new project (notice trailing period `.`):
    ```
    pip install django
    django-admin startproject storefront .
    ```
4. Run the Django Dev server (with app settings):


    **With app settings:** (use this one)
    ```
    python3 manage.py runserver
    ```
    Without app settings:
    ```
    django-admin runserver
    ```

## Install Debugger

Follow the instructions here:

* https://django-debug-toolbar.readthedocs.io/en/latest/installation.html

* TODO: Detail out this process.
    * `pip install django-debug-toolbar`
* TODO: Detail out launch.json config.


## Create App(s)
1. Create `store` and `tag` apps:

    ```
    python3 manage.py startapp store
    python3 manage.py startapp tag
    ```
2. Add app(s) to `settings.py`

    ```
    INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    ...
    'debug_toolbar',
    'store',
    'tag'
    ]
    ```
## Create Models
Add models to`models.py`
```

class Product(models.Model):
    title = models.CharField(max_length=255)
    description = models.TextField()
    price = models.DecimalField(max_digits=10, decimal_places=3)
    inventory = models.IntegerField()
    last_update = models.DateTimeField(auto_now=True)

```

## Relationships:
### One To One
Create a One-To-One relationship between Customers and Addresses.  Each customer has only one address and each address belongs to only one customer.

Add an `Address` class to `models.py`

```
class Address(models.Model):
    street = models.CharField(max_length=255)
    city = models.CharField(max_length=255)
    # Specify Parent
    customer = models.OneToOneField(Customer, on_delete=models.CASCADE, primary_key=True)
```

### One To Many
Allow Customers to have multiple address.

Amend the `Address` class in `models.py`

```
class Address(models.Model):
    street = models.CharField(max_length=255)
    city = models.CharField(max_length=255)
    
    # For One to One relationship
    # Specify Parent
    # customer = models.OneToOneField(Customer, on_delete=models.CASCADE, primary_key=True)

    # For One to Many relationship
    customer = models.ForeignKey(Customer, on_delete=models.CASCADE)
```

Do the same for: 
* Collection - Product 
* Customer - Order
* Order - Item
* Cart - Item

### Many To Many
Create a many-to-many relationship between Promotions and Products. A Promotion can have many Products and a Product and belong to many Promotions:

Add a `Promotion` class to `models.py` and reference it in the Product Class.  There is no need to create the reverse reference in the `Promotion` class.  It will be auto generated by Django. The column name defaults to `product_set`.  
```
class Promotion(models.Model):
    description = models.CharField(max_length=255)
    discount = models.FloatField()

class Product(models.Model):
    #  Custom Primary Key:
    #  product_id = models.CharField(max_length=15, primary_key=True)
    title = models.CharField(max_length=255)
    description = models.TextField()
    price = models.DecimalField(max_digits=10, decimal_places=3)
    inventory = models.IntegerField()
    last_update = models.DateTimeField(auto_now=True)
    collection = models.ForeignKey(Collection, on_delete=models.PROTECT)
    promotions = models.ManyToManyField(Promotion)
```
### Circular Relationships
A circular relationship exists between Product and Collection.  A collection has a `featured_product` (Product foreign-key reference) and a Product has a `collection` (Collection foreign key reference).

Since the Product class is defined in `models.py` after the Collection class, wrap the Product class name in single quotes `'Product'`. Also, set related_name to '+' for django to ignore this field. 
```
class Collection(models.Model):
    title = models.CharField(max_length=255)
    featured_product = models.ForeignKey('Product',on_delete=models.SET_NULL,null=True, related_name='+')

```
### Generic Relationships

To create generic relationship types between apps, for instance, Tags and Products or Likes and Users, add the following fields:
* content_type
* object_id
* content_object

Additionally, import the referenced classes.

```
from django.db import models
from django.contrib.contenttypes.models import ContentType
from django.contrib.contenttypes.fields import GenericForeignKey

# Create your models here.
class Tag(models.Model):
    label = models.CharField(max_length=255)

class TagItem(models.Model):
    tag = models.ForeignKey(Tag, on_delete=models.CASCADE)

    # Generic Type
    content_type = models.ForeignKey(ContentType, on_delete=models.CASCADE)
    object_id = models.PositiveBigIntegerField()
    content_object = GenericForeignKey()
```
